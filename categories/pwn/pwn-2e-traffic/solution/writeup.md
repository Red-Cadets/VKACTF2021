## Комрад ИИ

| Событие | Название | Категория | Сложность |
| :------ | ---- | ---- | ---- |
| VKACTF 2021 | Комрад ИИ | Pwn | easy |

### Описание

> Автор: b1n4r9
>
> Коммунисты разрабатывают искусственный интеллект, специализирующийся на автоматической эксплуатации практически любых информационных систем. Они решили в первую очередь проверить прототип на своих же сервисах. Однако, благодаря наводке нашего информатора, мы смогли вовремя перехватить трафик проводимого испытания. Дело за малым, сказать спасибо нашим конкурентам и повторить их "успех".

### Решение
Из полученного трафика в первую очередь можно достать информацию о ip:port настоящего сервиса, который оказывается рабочим. Это означает, что флаг скорее всего не в трафике, а его предназначение - найти каким образом проэксплуатировать сервис без бинарника.

На указанном адресе обнаруживаем такой же сервис, с которым шел обмен данными в трафике.

```
root@pwner:~# nc ip 31448
 _____________________________ 
|  _________________________  |
| |                         | |
| | ТАЛОНЫ РАБОТНИКАМ ТРУДА | |
| |_________________________| |
|_____________________________|

Представьтесь, товарищ.
> 
```

После изучения функционала сервиса становится ясно, что необходимо купить флаг под пунктом 7.
```
[7] Флаг. Новый. Качественный :: Стоимость: 31337 социальных баллов
```

Однако баланс в 150 баллов не позволяет нам это сделать.

После изучения трафика в самом конце узнаем, что отстутствует проверка на индекс массива талонов (< 0).

Можно обнаружить, что при покупке талона "-13", происходит повышение баллов.
```
=== Приобретение талона ===
Укажите номер талона:
> -13
�
===========================

==== СЕРВИС ОБМЕНА ТАЛОНОВ ====
[1] Проверить свой статус
[2] Показать доступные талоны
[3] Получить талон
[4] Выход
> 1

=== Информация о пользователе ===
Ваше имя: pwner
Ваш баланс: 2611 социальных баллов
Ваш статус: Базовый
=================================
```

Однако при наборе достаточного количества баллов приобрести флаг все равно невозможно - необходимо повысить статус.
```
=== Информация о пользователе ===
Ваше имя: pwner
Ваш баланс: 32143 социальных баллов
Ваш статус: Базовый
=================================

==== СЕРВИС ОБМЕНА ТАЛОНОВ ====
[1] Проверить свой статус
[2] Показать доступные талоны
[3] Получить талон
[4] Выход
> 3

=== Приобретение талона ===
Укажите номер талона:
> 7
Данный талон доступен только для верхушки партии. Повысьте свой статус.
```

При дальнейшем изучении трафика можно выяснить, что имя пользователя можно переполнить на несколько байт, изменив его статус. При поиске статусов можно обнаружить, что кроме "Базовый" и "Неизвестно" в трафике присутствует статус "Повышенный". Для этого отправляется 120 байт паддинга и число 297 (\x29\x01).

Совместив две уязвимости, можно написать эксплоит, который даст нам возможность купить флаг.

**Флаг:**

> vka{g37_3xpl017_fr0m_tr4ff1c_l1k3_4_pr0}
