## Опять шифровальщик

| Событие | Название | Категория | Сложность |
| :------ | ---- | ---- | ---- |
| VKACTF 2021 | Опять шифровальщик | For | Hard |

***

> Автор: Pashkevich
>
> Дано: crypto_dump.dmp [скачать](https://disk.yandex.ru/d/d_nFwqkVegZUVg)
>
> **Пароль:** pLSZXJjFx5sCqP2ryZ7qw63UsQx7AvJbbUkb
>
> Наши помощники кое-как перехватили целый автономный космический корабль коммунистов и передали его нашему отделу на Марсе. Мы смогли достать несколько служебных файлов, но хорошо бы, ко всему прочему, вытащить данные с их изолированного бортового компьютера. Наш отдел сразу взялся за эту работу. Методы защиты данных не так очевидны и наши специалисты разводят руками. Нам нужно поскорее разобраться, пока коммунисты не обнаружили пропажу!

### Решение
Определяем ОС дампа, ищем запущенные программы. Обнаруживаем TrueCrypt, следовательно ищем пароль от контейнера:
`python vol.py -f dump.dmp --profile=Win7SP1x64 truecryptsummary `.
Продолжая анализировать дамп (например с помощью R-Studio) находим файл **container** и **secret_traf.pcapng**. Container извлечь не получится, поэтому преходим к трафику.

Извлекаем его с помощью Volatility:
```
python vol.py -f crypto_dump.dmp --profile=Win7SP1x64 dumpfiles -Q 0x000000007d609640 -D .
```

Теперь приступаем к анализу трафика. В нем находим передачу файла **container.pdf**, hex-представление которого нужно записать в файл. Просматривая полученный файл любым PDF-ридером снова видим Hex байты, которые снова записываем в новый файл – это и будет контейнер от TrueCrypt.
>
> Важно учитывать, что буфер обмена может не поместить весь поток байт и рабочий файл не получится.
>
Монтируем контейнер с ранее полученным из образа паролем и встречаем ряд файлов среди которых – `flag_enc.txt`. Остается разобраться, как работает шифрование (исходники в контейнере). Компилируем `.exe` из исходников, запускаем и декодируем строку.
Получаем строку `vka 1n73r3571n6 fur7h3r f473`. Доводим до форматной строки и получаем флаг.

### FLAG
`vka{1n73r3571n6_fur7h3r_f473}`
